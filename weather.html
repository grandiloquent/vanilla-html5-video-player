<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>桃江县天气预报 - 回形针</title>
    <link rel="stylesheet" href="index.css">
    <script src="./components/header.js"></script>
    <style>
        #alarm {
            background-color: #f0ad4e;
            color: #fff;
            font-size: 1.5rem;
            padding: 18px;
        }

        #temperature {
            font-size: 62px;
            color: #fff;
            line-height: 62px;
            height: 62px;
            padding-top: 66px;
            position: relative;
            text-align: center;
        }

        #temperature:after {
            content: "\B0";
            position: absolute;
            text-align: left;
            top: 66px;
        }

        #weather {
            font-size: 22px;
            color: #fff;
            line-height: 22px;
            height: 22px;
            margin-top: 8px;
            text-align: center;
        }

        #wind-humidity {
            margin-top: 10px;
            height: 14px;
            position: relative;
            text-align: center;
        }

        .txt {
            height: 14px;
            line-height: 14px;
            font-size: 14px;
            color: #fff;
            position: absolute;
            width: 100%;
            top: 0;
            left: 0;
            animation-fill-mode: forwards;
            animation-duration: .75s;
            animation-name: wind-hide;
        }

        @keyframes wind-show {
            0% {
                transform: translate3d(0, 14px, 0);
                opacity: 0
            }

            to {
                transform: translateZ(0);
                opacity: 1
            }
        }

        @keyframes wind-hide {
            0% {
                transform: translateZ(0);
                opacity: 1
            }

            to {
                transform: translate3d(0, -14px, 0);
                opacity: 0
            }
        }

        .txt.show {
            animation-name: wind-show;
        }

        #tips {
            font-size: 16px;
            color: #fff;
            line-height: 1.5;
            height: 16px;
            margin: 50px 60px 0;
            position: relative;
            z-index: 2;
            text-align: center;
        }

        #days {
            border-top: 1px solid #e4e4e4;
            border-bottom: 1px solid #e4e4e4;
            background-color: #fff;
            margin-bottom: 10px;
            display: block;
            margin: 0 auto;
            box-sizing: border-box;
        }
    </style>
</head>

<body>
    <h1 hidden>帮助</h1>

    <div class="app">
        <custom-header></custom-header>
        <div style="background-image: -webkit-linear-gradient(-90deg, #86c3ca, #b5e9e8);padding-bottom: 20px;">
            <div id="alarm">
                <h2></h2>
                <div></div>
            </div>
            <div id="temperature">
            </div>
            <div id="weather"></div>
            <div id="wind-humidity">
                <p class="txt"></p>
                <p class="txt"></p>
            </div>
            <div id="tips">

            </div>

        </div>
        <div style="background: #fff;text-align: center;margin: 20px 0;padding: 20px 0;display: flex;">
            <div style="width: 50%;padding: 0 20px;box-sizing: border-box;">
                <div style="font-weight: 700;padding-bottom: 10px;">今天</div>
                <div style="display: flex;justify-content: space-between;">
                    <div id="today_weather">
                    </div>
                    <div id="today_min_max">
                    </div>
                </div>
            </div>
            <div style="width: 50%;padding: 0 20px;box-sizing: border-box;">
                <div style="font-weight: 700;padding-bottom: 10px;">明天</div>
                <div style="display: flex;justify-content: space-between;">
                    <div id="tomorrow_weather">
                    </div>
                    <div id="tomorrow_min_max">
                    </div>
                </div>
            </div>
        </div>
        <div id="days">
            <div style="display: grid;grid-template-columns: repeat(5, minmax(0, 1fr));text-align: center;">
                <div>
                    <p>昨天</p>
                    <p></p>
                    <p></p>
                </div>
                <div>
                    <p>今天</p>
                    <p></p>
                    <p></p>
                </div>
                <div>
                    <p>明天</p>
                    <p></p>
                    <p></p>
                </div>
                <div>
                    <p>后天</p>
                    <p></p>
                    <p></p>
                </div>
                <div>
                    <p>大后天</p>
                    <p></p>
                    <p></p>
                </div>
            </div>
        </div>

        <div id="location"
            style="display: flex;height: 32px;line-height: 32px;text-align: center;justify-content: space-evenly;">
            <div data-src="?province=湖南省&city=益阳市&county=桃江县">桃江县</div>
            <div data-src="?province=湖南省&city=益阳市">益阳市</div>
            <div data-src="?province=湖南省&city=长沙市">长沙市</div>
            <div data-src="?province=广东省&city=广州市">广州市</div>
        </div>
    </div>
    <script>
        /*
        navigator.geolocation.getCurrentPosition(function (position) {
            // position.coords.latitude position.coords.longitude
            // , 
            fetch(
                    'https://wis.qq.com/weather/common?source=xw&refer=h5&weather_type=forecast_1h|forecast_24h|index|alarm|limit|tips&province=%E5%8C%97%E4%BA%AC%E5%B8%82&city=%E5%8C%97%E4%BA%AC%E5%B8%82&county=%E6%B5%B7%E6%B7%80%E5%8C%BA&callback=reqwest_1622620766213'
                    // `https://api.waqi.info/feed/geo:${28.518635};${112.153135}/?token=5dc12dc6b3459cb49fc9079a5d0f4ebd481565c5`
                )
                .then(res => res.json())
                .then(res => {
                    console.log(res);
                })
        });
        */
        // https://wis.qq.com/weather/common?source=xw&refer=h5&weather_type=forecast_1h|forecast_24h|index|alarm|limit|tips&province=湖南省&city=益阳市&county=桃江县
        // https://wis.qq.com/weather/common?source=xw&refer=h5&weather_type=air&province=湖南省&city=益阳市&county=桃江县
        // https://hxz315.com/api/weather?province=湖南省&city=益阳市&county=桃江县




        document.querySelectorAll('#location>div')
            .forEach(x => {
                x.addEventListener('click', event => {
                    loadWeather('https://hxz315.com/api/weather' + x.dataset.src);
                });
            })
        document.querySelectorAll('#location>div')
            .forEach(x => {
                x.addEventListener('click', event => {
                    document.title = x.textContent + '天气预报 - 回形针';
                    loadWeather(`https://lucidu.cn/api/weather${x.dataset.src}`);
                });
            })
        loadWeather();

        let timer = 0;

        function loadWeather(uri) {
            fetch(uri || 'https://lucidu.cn/api/weather?province=湖南省&city=益阳市&county=桃江县')
                .then(res => res.text())
                .then(res => {
                    var obj = JSON.parse(res);
                    if (obj.data.alarm.length) {
                        document.getElementById('alarm').style.display = 'block';

                        document.getElementById('alarm').querySelector('h2').textContent = obj.data.alarm[0]
                            .type_name +
                            '预警';
                        document.getElementById('alarm').querySelector('div').textContent = obj.data.alarm[0]
                            .detail;
                    } else {
                        document.getElementById('alarm').style.display = 'none';
                    }

                    document.getElementById('temperature').textContent = obj.data.observe.degree;
                    document.getElementById('weather').textContent = obj.data.observe.weather_short;

                    const items = document.getElementById('wind-humidity').querySelectorAll('p');
                    items[0].textContent = `湿度 ${obj.data.observe.humidity}%`;
                    items[1].textContent = `风速 ${obj.data.observe.wind_power}级`;

                    let first = true;
                    clearInterval(timer);
                    timer = setInterval(() => {
                        first = !first;
                        if (first) {
                            items[0].classList.add('show');
                            items[1].classList.remove('show');
                        } else {
                            items[1].classList.add('show');
                            items[0].classList.remove('show');
                        }
                    }, 3000);
                    document.getElementById('tips').textContent = obj.data.tips.observe["1"];
                    document.getElementById('today_min_max').textContent =
                        `${obj.data.forecast_24h["1"].min_degree}/${obj.data.forecast_24h["1"].max_degree}°`;
                    document.getElementById('today_weather').textContent =
                        `${obj.data.forecast_24h["1"].day_weather}转${obj.data.forecast_24h["1"].night_weather}`;
                    document.getElementById('tomorrow_min_max').textContent =
                        `${obj.data.forecast_24h["2"].min_degree}/${obj.data.forecast_24h["2"].max_degree}°`;
                    document.getElementById('tomorrow_weather').textContent =
                        `${obj.data.forecast_24h["2"].day_weather}转${obj.data.forecast_24h["2"].night_weather}`;

                    const days = document.querySelectorAll('#days>div>div')

                    days[0].querySelector('p:nth-child(2)').textContent = obj.data.forecast_24h[0].day_weather;
                    days[0].querySelector('p:nth-child(3)').textContent =
                        `${obj.data.forecast_24h[0].min_degree}/${obj.data.forecast_24h[0].max_degree}°`;

                    days[1].querySelector('p:nth-child(2)').textContent = obj.data.forecast_24h[1].day_weather;
                    days[1].querySelector('p:nth-child(3)').textContent =
                        `${obj.data.forecast_24h[1].min_degree}/${obj.data.forecast_24h[1].max_degree}°`;

                    days[2].querySelector('p:nth-child(2)').textContent = obj.data.forecast_24h[2].day_weather;
                    days[2].querySelector('p:nth-child(3)').textContent =
                        `${obj.data.forecast_24h[2].min_degree}/${obj.data.forecast_24h[2].max_degree}°`;

                    days[3].querySelector('p:nth-child(2)').textContent = obj.data.forecast_24h[3].day_weather;
                    days[3].querySelector('p:nth-child(3)').textContent =
                        `${obj.data.forecast_24h[3].min_degree}/${obj.data.forecast_24h[3].max_degree}°`;

                    days[4].querySelector('p:nth-child(2)').textContent = obj.data.forecast_24h[4].day_weather;
                    days[4].querySelector('p:nth-child(3)').textContent =
                        `${obj.data.forecast_24h[4].min_degree}/${obj.data.forecast_24h[4].max_degree}°`;
                });
        }
    </script>
</body>

</html>